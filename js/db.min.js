var uplannerDB=function(){var uDB={},datastore=null;return uDB.open=function(callback){var version=1,request=indexedDB.open("events",1);request.onupgradeneeded=function(e){var db=e.target.result;e.target.transaction.onerror=uDB.onerror,db.objectStoreNames.contains("event")&&db.deleteObjectStore("event");var store=db.createObjectStore("event",{keyPath:"timestamp"})},request.onsuccess=function(e){datastore=e.target.result,callback()},request.onerror=uDB.onerror},uDB.fetchevents=function(callback){var db,transaction=datastore.transaction(["event"],"readwrite"),objStore=transaction.objectStore("event"),keyRange=IDBKeyRange.lowerBound(0),cursorRequest=objStore.openCursor(keyRange),events=[];transaction.oncomplete=function(e){callback(events)},cursorRequest.onsuccess=function(e){var result=e.target.result;0!=!!result&&(events.push(result.value),result.continue())},cursorRequest.onerror=uDB.onerror},uDB.createevent=function(event,callback){var db,transaction,objStore=datastore.transaction(["event"],"readwrite").objectStore("event"),timestamp=(new Date).getTime(),request=objStore.put(event);request.onsuccess=function(e){callback(event)},request.onerror=uDB.onerror},uDB.deleteevent=function(id,callback){var db,transaction,objStore,request=datastore.transaction(["event"],"readwrite").objectStore("event").delete(id);request.onsuccess=function(e){callback()},request.onerror=function(e){console.log(e)}},uDB}();